CREATE TABLE [dbo].[Invoice] (
    [Id] [int] NOT NULL IDENTITY,
    [CustomerPhone] [nvarchar](100) NOT NULL,
    [OperatorId] [int],
    [DeliveryStaffId] [int],
    [StatusId] [int],
    [TotalPrice] [decimal](18, 2),
    [CreatedById] [int],
    [CreatedDate] [datetime],
    [ModifiedById] [int],
    [ModifiedDate] [datetime],
    [Deleted] [bit] NOT NULL,
    CONSTRAINT [PK_dbo.Invoice] PRIMARY KEY ([Id])
)
CREATE TABLE [dbo].[InvoiceCommodity] (
    [Id] [int] NOT NULL IDENTITY,
    [InvoiceId] [int] NOT NULL,
    [CommodityId] [int] NOT NULL,
    [Quantity] [int] NOT NULL,
    [CreatedById] [int],
    [CreatedDate] [datetime],
    [ModifiedById] [int],
    [ModifiedDate] [datetime],
    [Deleted] [bit] NOT NULL,
    CONSTRAINT [PK_dbo.InvoiceCommodity] PRIMARY KEY ([Id])
)
IF schema_id('LookUp') IS NULL
    EXECUTE('CREATE SCHEMA [LookUp]')
CREATE TABLE [LookUp].[InvoiceStatus] (
    [Id] [int] NOT NULL IDENTITY,
    [Name] [nvarchar](500) NOT NULL,
    [DisplayOrder] [int] NOT NULL,
    [CreatedById] [int],
    [CreatedDate] [datetime],
    [ModifiedById] [int],
    [ModifiedDate] [datetime],
    [Deleted] [bit] NOT NULL,
    CONSTRAINT [PK_LookUp.InvoiceStatus] PRIMARY KEY ([Id])
)
CREATE INDEX [IX_OperatorId] ON [dbo].[Invoice]([OperatorId])
CREATE INDEX [IX_DeliveryStaffId] ON [dbo].[Invoice]([DeliveryStaffId])
CREATE INDEX [IX_StatusId] ON [dbo].[Invoice]([StatusId])
CREATE INDEX [IX_CreatedById] ON [dbo].[Invoice]([CreatedById])
CREATE INDEX [IX_ModifiedById] ON [dbo].[Invoice]([ModifiedById])
CREATE INDEX [IX_InvoiceId] ON [dbo].[InvoiceCommodity]([InvoiceId])
CREATE INDEX [IX_CommodityId] ON [dbo].[InvoiceCommodity]([CommodityId])
CREATE INDEX [IX_CreatedById] ON [dbo].[InvoiceCommodity]([CreatedById])
CREATE INDEX [IX_ModifiedById] ON [dbo].[InvoiceCommodity]([ModifiedById])
CREATE INDEX [IX_CreatedById] ON [LookUp].[InvoiceStatus]([CreatedById])
CREATE INDEX [IX_ModifiedById] ON [LookUp].[InvoiceStatus]([ModifiedById])
ALTER TABLE [dbo].[Invoice] ADD CONSTRAINT [FK_dbo.Invoice_dbo.User_CreatedById] FOREIGN KEY ([CreatedById]) REFERENCES [dbo].[User] ([Id])
ALTER TABLE [dbo].[Invoice] ADD CONSTRAINT [FK_dbo.Invoice_dbo.User_DeliveryStaffId] FOREIGN KEY ([DeliveryStaffId]) REFERENCES [dbo].[User] ([Id])
ALTER TABLE [dbo].[Invoice] ADD CONSTRAINT [FK_dbo.Invoice_dbo.User_ModifiedById] FOREIGN KEY ([ModifiedById]) REFERENCES [dbo].[User] ([Id])
ALTER TABLE [dbo].[Invoice] ADD CONSTRAINT [FK_dbo.Invoice_dbo.User_OperatorId] FOREIGN KEY ([OperatorId]) REFERENCES [dbo].[User] ([Id])
ALTER TABLE [dbo].[Invoice] ADD CONSTRAINT [FK_dbo.Invoice_LookUp.InvoiceStatus_StatusId] FOREIGN KEY ([StatusId]) REFERENCES [LookUp].[InvoiceStatus] ([Id])
ALTER TABLE [dbo].[InvoiceCommodity] ADD CONSTRAINT [FK_dbo.InvoiceCommodity_LookUp.Commodity_CommodityId] FOREIGN KEY ([CommodityId]) REFERENCES [LookUp].[Commodity] ([Id])
ALTER TABLE [dbo].[InvoiceCommodity] ADD CONSTRAINT [FK_dbo.InvoiceCommodity_dbo.User_CreatedById] FOREIGN KEY ([CreatedById]) REFERENCES [dbo].[User] ([Id])
ALTER TABLE [dbo].[InvoiceCommodity] ADD CONSTRAINT [FK_dbo.InvoiceCommodity_dbo.User_ModifiedById] FOREIGN KEY ([ModifiedById]) REFERENCES [dbo].[User] ([Id])
ALTER TABLE [dbo].[InvoiceCommodity] ADD CONSTRAINT [FK_dbo.InvoiceCommodity_dbo.Invoice_InvoiceId] FOREIGN KEY ([InvoiceId]) REFERENCES [dbo].[Invoice] ([Id])
ALTER TABLE [LookUp].[InvoiceStatus] ADD CONSTRAINT [FK_LookUp.InvoiceStatus_dbo.User_CreatedById] FOREIGN KEY ([CreatedById]) REFERENCES [dbo].[User] ([Id])
ALTER TABLE [LookUp].[InvoiceStatus] ADD CONSTRAINT [FK_LookUp.InvoiceStatus_dbo.User_ModifiedById] FOREIGN KEY ([ModifiedById]) REFERENCES [dbo].[User] ([Id])
INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
VALUES (N'201704270851526_AutomaticMigration', N'Cpi.Application.DatabaseContext.CpiDbContext+MigrationConfiguration',  0x1F8B0800000000000400ED3DD96EE43892EF0BEC3F24F271D0E3B4ABD0404FC19E41B55D3530A60E4FA5BBB16F0D3A93B685524AB992B2C6C662BF6C1FF693F61796BA7933285154CA16FCE214C9603018078F88E0FFFDCFFF9EFFED69172E7EE0240DE2E862797672BA5CE068136F83E8E16279C8EEFFFCCBF26F7FFDF77F3BFFB0DD3D2D7EAFEBBDCDEB9196517AB17CCCB2FDBBD52ADD3CE21D4A4F76C12689D3F83E3BD9C4BB15DAC6AB37A7A77F599D9DAD3001B124B0168BF36F87280B76B8F8417E5EC6D106EFB3030A3FC75B1CA6D57752B22EA02EBEA01D4EF768832F9697FBE0E4FD7E1F061B94115C4EAE5086EE508A098C0C3F65CBC5FB304004AD350EEF970B14457156547CF75B8AD75912470FEB3DF980C2DBE73D26F5EE5198E26A30EFDAEAD0719DBEC9C7B56A1BD6A03687348B779600CFDE56845AF1CD3B917BD9109290F2032179F69C8FBA2027A1240AC3ABDD72C177F5EE324CF26A725A9733745236FE69C155F9A9E111C24AF91FA97108B343822F227CC81214FEB4B839DC91EAFFC0CFB7F1771C5D448730A41125A89232E603F97493C47B9C64CFDFF07D85FEF576B958B1ED567CC3A619D5A61CDA7594BD7DB35C7C219DA3BB10377C4091619DC509FE3B8E708232BCBD415986932887810B4A0ABD737D5D1664C549FEABEE95302011ACE5E2337AFA84A387ECF16249A66BB9F8183CE16DFDA5C2E4B7282072481A65C901433BBB798C235D6F67C0DE04BAE8BBBFC2614094C8336190A6F7FCFFDB60676CFB759F13384E84B98175B9CED0FDBD65DBF7DB6D82D3B4A68F925A6F9DCC0DC1303BA49628DE122E0C6F9260D3D2136F821D0A978B9B84FC57E9EB5F968BF506E5F364847819EFF621CE39BBCB2C5D263897825F9F2DC751B5EBD225D134C17DD0A1CFBA21A8D32FE847F050083C8F39D17084663B022C0B70BA5C7CC361512F7D0CF6A57DA9B4E01F42D58F49BCFB16878D92E56BFCB18E0F4931B5B1B6DA2D4A1E706681733D4B5A6CDB4A229E759912C3A6822D6E8CC0EAF0E32A0A3832E52A3CD94AB6B8B6ACA74394AE2560D916AA50A46AD8E257EB4C1D766D1D01B7BA488559536E8B57A9EA7458D535049CCA02154655A90C9FF355BBB231AE776AE17AEEB5F0A1A0CC2B208DEE27A432F767B45A25A9FB02FAE7015548F742E7559A41B7B6AF166283EDAB350118D19A53A4D87E8AE3EFBFED29C1D5216EAC2C8CC1DCC27A384653CEF4A6B2E9D24A522D2BAF3980E5A43B529B50792D23E606A30A3616C284763417251C91FD66BBA1EECB72DB63A9C2AF23B4C9C8DAB0EEE0D79830128AACE118F6F53F0FB4D30ED27D889EBF265B9CCCA6CCFD8ECEB19DE0D515DCB2B8B11392FE649642530D3284A1AC85D895DC5EE8EA01F07765337E4B71D2D950948D67B3A0EE2BA75064384CFDD9C179DD473204433F031DA37E0936DF0D3DBF1DA4E31B94A6FF8A93AD037B06EB688DC26CF0CE6EF16E0F18D91B177DE5CC99EB97BEDBD41CCED7CDE6B02F44C6D24C7E4269F6297E08E6135E07A6B354C8727BC997094646A8E0D83256F0E5E6502854A1D7E30492E5531D8E7C4D014FB6820A57AE56177C7378264CCB3A521CF30F3AEC8A72079B4E76A46E769E3CCC799DA1EE6BDED8BD2C452E9700DD46485D57B19BD03418644B24F4A7DB17692A4387E3F654AD5696EE545B096D566AB3527B7D4AADE47D933AE36B69245FA83A980AAB7A32292FA19A1979C7D700280CCB1B6847F70014BC5969CD4AEB75292D9AFBB5C7D1D27AAAF35C79E5610EA4E9BEB427D2F28A9021B85260D7D18F38D8745F6A35ED673DA591D771BD6F47F0A03D169FD659C132FAA99156B95E95140BBA4856C7BDAB67DB8BD2DB53514583703F9FCF0A8EE982B8ED4ED64086BE584F33064965C736ACED4B6EBA64E51A8487F2626D7B9039B28AA51A148770676DA18B1EAD7C990635177EAD1CCB74F7551201CD465FD35749ADD9C175EA1655EB372ACAC41F540341E6A5F554F22FAFECD60148D6956669007301D256EE68778733B6BCAF2EC832BB35B66617266D45C804B83DF1AA3A7079E8C5819C4D8BBAAFF9DC6B72460470EEC50980EEE84B59557174A4AE3FC80118DF9DEE0C4C5D1738968E8AED7D9AC69BA0C05FE5D22FB8F6B234FA106D17D67EBEA5CC4A9D57890C137D16E40A8FFCBE589E09B362D36363D5DA1E850037B6BF3F09FD118D88935C2521D22E4A898E0DA24C549F41B409F628B425060708A889F3196DBAE44BAEF01E47B912B52513041766252E22D5F4CD190E1311CF57142BEA3954703953B187DAFFACE586DA1BD9C4041AA8121E93433D3D3911B9B91377A970F0C04C2AA2827887B67863F20EA58A0DD32C53C40EB847A2AEFDB38F88843FFE11E90AE99B5DBF8CC241463F29BDB182384DF1D651747584F31BD8F3CA23FB4171F2661ACD93320DED66767BB36413BDF61B8C3BC7D58E60A4C6E3CFC96A4FB9B7BBC158AA5CDF1DD86185BFBC35933BB7CD72C4FCD96739CD21FD8BB13923EB42C1F5CFAC8DD47E8032C6A8BD74BBE83DA51BE1280A4F858D574DA722FED46CB0E8B7096607A8DD75C079C7626B95E88CC17B2FC1BE16315A00F3C7066C39B2A94C949705EBBA37A234267ECD274D58A8E1AC836347545DF24B508B2358B3D1B43A7E85F5359AEED2A233CEE1EE940DA7E20E18CE1210D3E98CFF8EC178EAF1198503276B3ED509C3543C01C81ED6E3EA09D2CF088C6744C603D719093F0DADA749F5066505BDC673C873E36A3B33362370DDA4359DC5DDBE294133CB6F76B7F8A60498BEAFEEF563F5C4643D2FE9AB9CB2A3B216C876424CA6BDD63A060339A25D9CB63914C25D0C33AD087C71C043F25019FF7C24C5C31F2F49090CE95E889D1B93A7802B2BD082AA13378DBF7C1A73D5F402164B4D889561A2C5602B07DC238467F9E71D1E057F9CC35314D2331DEF3BE681963C8EDF70C66408EA170EB498D41BD6275AFAAC00FE4FB4B4F8F83BD1D24EC234D653FA540C166C013A5675C7854771B0AA47681C3E9CBA0DADE2800DC68E8F0876603FB918622BE6756E495964FCD95196AE907EDB1416A3708D2C55836AA2B5791BDAE9A672BDC0994897EFC1A362D2A0E1818934049E863554E5D330CFBAF18CA127578D7ED26040C52B774DFCBC411B0C6F60054364BCC06F1D6F7640A1F5FDA2F4FA70A1162F7FACA89D0C90C61B3D564E9BD8C0863B0016D5212F1E818D1DFB7E1B320993B2BA96B7DCC0540F0372E1B87B501042E3F0E164F7A0DA4429E6459A2E45196025A8BB0387A566E9C7EC3DD785EAD17B5D1CAAE90342A34D47353207C2552054F375DD7B1C859E1B59BDBD0CAD66BCA0D2250474C64F63DE54A9B1F0CA4B13BEAF52E7DFD11FDF0392F1F0FB49217D96ED958139A18FF74B03234ADEAE0D8C13328DDD833197921D8B40EEB19CF3E531DC6699711A8D335F80E5355C6BA973DD3AB3BAA6FB2D03530F6182BDDF72A9C80CE9DAEB45D78722191B6993911638A995ED3EB8BACB3FE2A74C924B92E8892A9D645AE52EE4B92207BAC61973E39A2E171F9AD46FDC25AAC05622006A87A982C46C420D208583641950C969B3016CA94265B06AE50AC28BCFF2A0464ECC0701EEA00C7CD583AE836361D4A46EAE35E464EEB70D801B4192C1A314150C8C61BA656719A081732A4D3D7641F771E02929D5B0AAF8C639D50EFC303AAF5CBAE44F6CC8211728418175C99848F521EA018E7E2B968000E20A39FC24B4D4E7F96386A5CCF4478DA2D1111AF22873FB99E1742702B596555341B5E095A12F59E376A38364DD3A0821CC6F4FAA240D9A874D2204804C6C829C490C8451D800B9D77C1255CF6D9619C420C3D573A343BAFAE256790E2BB5E8EA925DC9A44E91EEAA9B082B125CD9CF402F0EE453FAE8594FA80D6105BE919ED99A451888CD04D89E0457C84603A29BA5B02A53DE38A4DC08A299F76C10CAA20A4882E8542E3D04B100A3154105753B7391E2450BD0C2152C7E7A4711A78B559F12A87A8E02423C0B19347838B8249F2F3154A7D190100F987383199A39EB86C5F60508D92BC5F4FC064D1AA11D999ED77A11CD279FC1F6E5907407C290603BF0E698CD40A0D1F6DA423CBE863E40D983881C9426FE044CF0FB561342E31F2E1B84DC3DBC1B41E4AEE04312C5AC6C6C740C48B50069E15991B46F282AC92077B190E12E7858742381E04D31E48A471EABAA5EF100625B654B127D74ABB8E2610FB8CD4B1E7D3CAB2F0282D68C90C84CD31041ABC63E34F42C86F55BA14A2194DDB6CA6487BB6CED2680DCC5AA1D653B104116F226218531324E714FAC9537FADE4743195D34DC208CA10ADCD2D2056AC34D515E7DE8E3D198EBDFE054120A10A6241B9B3E50492419782F010A4DB2DA143BA22540186DB7B1A0401BC7B4F42AB0F02DAD45908869887A73E88086BECCA1FE5D579DEA33853728B49526C0A18F12D48434D84D4C2F1A82F8CF92EDA0DC06A7957FDED26D7A4CAEE58A41E8B63ED614F1B901523B3F2B57F0407F69C912DBEC312D9839D1E3C5B89037FB487BA427644B0475F5058C15B231724052FF32ABDE21E95D521522A6DE27594BAB69B76422B7862CF51BB68DDB645376BE5A6F1EF10E551FCE57A4CA06EFB3030A3F176F6CD7059FD17E1F440F69DBB2FAB258EFD126DFF3FD79BD5C3CEDC228BD583E66D9FEDD6A9516A0D3935DB049E234BECF4E36F16E85B6F1EACDE9E95F566767AB5D0963B561A8CD3B79363D115D861E30579A078B6FF1C72049B3FC69F03B94BF1F7DB9DD89D568275196740DB1EBAE583F5071FA6A67B9BA7EFE7FE38A2A3C579EE354755C7B9072205B7A7E2443DCE58EB9C51BDFC2C65B6C489AAE37284489E441F1CB383CEC22B587B0BAF565E1438B93FC170B872DB18778F318470A9055111C66BD492C1FD7A641B2257088742C110D4F176364C6AF49AB2143519973430DF7FD769BE034ADDF6EA7A172457098AD1B370D4EEDDCAD86741B6728BC49820D3727F4770BBE8977FB1017BE35C22CF3651650E9F01C06A42E6EC7084F82225D0087C7C668D000F5D11B6688228A6C891422D15EF9FE238E16BFA3F040DA9C0ABC8CC92865ADCF579C66E3B5E94A50A79C5DE3B5335877333B22D74A9CF6BAEEA6CDB5100652EB557A7386431529CF3550E8EC2C9C3CB6057078FF3CA082322CB0F6EB2CD66688AF44AC2587962E055B0CA0B1176D008C61845B6272ADADED7584361959967078345FE190C495A3ED8AF12A48F7217AFE9A6C71C2F1255332AB0733C457A21EEA2303973AA10A84B35704AA86C3487FDE5B24C85CFB150EE9E3210C4548ED570B1D106CBE8B90DAAF16BA0DA5E9BFE284A350FBD51ED21A85991C5A5962B1DFC1BBBD1C3FB6C46E2EF3F3219E23740F5DEAA1B1EF4AF330F5AF4EAB217F4269F6297E08245B33AE68D6D16688AF4447ABC266DCAFE38458E3AE8B3933A06174FABC869AE57344F9AC636A8691CC2A54BF8F4CAA40CCD2384BE38B9246D6557280130F3AC745E7230F2D90592667997C213249DDEDBB14C5363D8CBD046ADA0E7B41ECF23A771A97AF477B513AAB9D57A17606BBFC90A493EAAC8846B8FEA03254B37717CAC4D56A58F30DE72CE5A32EF8056F3FF76B7E3EB75BD765BF11CEBCF29F857352C229F8CBF2559ADEAB2FCDEFC65FB6F255659C680B1AE62EB105EDD2CA6F96775E2DAB2C1784D03F826DEEB8BA7E4E33BC2BA4F864FD9FE1651890F1B6153EA328B8C769761B7FC7D1C5F2CDE9D99BE5E27D18A0B4F46CAEDC72DFF16951417EBA676F733F5DBCDDADF8E6F6DEBE399434DD86125FDF7C9A18A75BCE41F71FF8999F60480EDCF315DFF05CA283CAAC97414ED342C3FD1D47F97E036F6F5096E124CA6BE1CA507F398421BACB3DB7EF51980A8CCD83679D65CB8EA21F28D93C22A2583EA3A74F387AC81EF3593BA58117496A81B0AB6D9606F8190B1C8439EB405B02DF92FFB3201F891DA6F4FE8D22B690A7F73ADAE2A78BE57F15CDDE2DAEFFE38FB6E54F8B421BBF5B9C2EFEDBB67F61B3678704D7BC0F269C77AE66CEDEDA3344BB05B51B5FDDAECFC0E82D6BC52C7813EC5098EB29F25F5A289CB35F88881133428ADF58B33BE7EBDB8F2519836C472EAA691F8A3126BCDF6058E36D371ABA6D9FE1B0E6BEDF781ABB5F82B90B3283FAA2ADBDD1B828B7A6D3B5329507AF251F17AD54730EEB98DE0D5BF6DE36ED8542BB87A6FAB71DC6AC0C5EA3323038EA4E561D7436C320E8AD2F3074424418C6E5F0CF5D56ACCCA67DD606B336B0D206326FDDC9AA80D6ED57B7E7FCD996FAAD0FB0E3DD66EB12ACDD12D9ABC2C6F916AE6C2084605D85DDC2669D86B56706B6A069FF613B5DD0B6ECB55A139D8DEDD1A0DBF7514B9C87F2BC9F9C8D46ABBFAD96907AF7E0C91A917995360BDCF10A9CCCF77716B559D46651737B3CA274EA9D856D16B659D81C099BC27F77B23236ECE5F47CA1FC4AEE7C6765F88A95E1CBBB99A17C91EDE6BF69385FD7CE5AE1956A0580B7F16415C3BC2599E56D6479A3B207ABFC23F4AFC0E91E50ACD1933FFA4838FD1066411EB0407E9325A33068E58B790C60A18C05FB27012CD10938C945169176519A2528103DC9C90A37DA047B142A07C7B5002A9D7C2A1AD87CC915DEE328D7268A6143BAD4C62A9DAF9A2E385568220A93685ACF41FA87E885A75E99C9AC3FB173787A72A2E38EB251E9F56E84E5881F94F9C19C3301353AD0FCEB824E7CCEBF2A11FDCC00C332803EA8C70B07285E9CF7A7111437B4A23D12AB4C9C59C039B08E517328F8C6A3269919A703E31C81C6A15E8D6FD137AC541DCC32C82EF9B3493DE6D0898D02F5644E3DE959D7943E05A358A7CA9D41CE7875E18B512CCADC6FC76D8B2AFE18C50ACD0CA2E8F3B86C4E8E38C0DA7498CDE3342F1613E5D7B0A8F2247B541980574D0753199D0FDF26AA34AC0FC78EC4AC40DE6D9D996424263902D3C21DFC7AD423E39FB4FB638F4EC7EBA36B109E373CEA8F9939F45D1E89E6B0B8B3ABF2EEF01339B5DB39E5FB9A47C116AAB7D6BC3284570B0262A949AA8449990932EF8CD7E93CF73EE6DE9865D8E7FC7B5E1DBCFAC93F9E2540EDF43ECFBB8F79A78313C63C58A002B7FC9F3ED15163929305A678E2AC017A41E318D705123EF17F0235338AA9D7E3B12325DA26AFCFEE337A64D6A5E37CF9B334EA3727BC704513B3E8D1BCB471923428EAEBC47584EE0D9863B4212D0FF8DD5ECE7C707CFB4C316CAF0D1B1B2354401246286196171A30007ACCE5186306645CE4DBBC8CCE32DE15CDF42EBF247CE271F73233CA74762FED1A851B83EE3ACC728131055EB15B538CC32E9AD7BA3CF38A7F65322F668F4F63783B3A9F79E008CFD0B96403DE8FD1F96407E2D648A8317136813E4D778C2B5239CF783F529F99665267EBADAD011DAFF79EDDA3B443DD67D0AB59F27AE0FE817D83B039A0E1DE0B14F8A57AD690B9BA592E3E34493FB8AB93F2BDC18BE5F62E26535EA60DC9CB243C224266362DD22E981AAABEDA634253A7920341A15B499DBAE3B2A8ED1BDC6FAD8F85CEEA02D9D0F232E088C4F052C5B0C48A8AB17101B07034EAE8230D0275154DD7451C147036992B41D574329554F3D95432764D6934A147AA4C36AD5531B40B3DB3CA2A693AB59514C11828C82BD4535098A927E04069328DC80A2EC90BAA9D4A86F57ECCA62B858638D25241996B1C9A29484219478D154B0E00A9847C3912CAE873EA48D79514CEF527CD90E9142AC696DD0749AD8BD5A3542D9E27304C63E61325D743B3A5382082DEF850F22256198A407ABEB0CC0B327112C97359A8C54597F46298417523702F6EA982F0818224D41E8E3FD8851347C4BAD03D21A00223569F3A29F8B07BBD6014550642DEB318C82FC761CBA88105A1F3B2CB093120B200B9319E2439D4A1C2125A00E38A1D10C2EF125A13130BA0C280FCE09F0CB09D16244C54188804FFA31CBE490206677C10A1BA0F9075BA540F52E39C398D819AC57878E91D7888CD55B37A80F2DBE8231F9E361C496DA501E14BEEACB4E4049236D34CF1100401AD5B20813A1325091B60A21600D915995BE4BD89852C7A423270639085831917CEC28B86D4578783355A2C5044C194062DF787578F1CE03F3FD871B7FACA82A68EDBB59AD6E11B48A6A145636C82E8ED83852BF4B4492277E1D52A1193CB6F1F9D70446401318817BEF06245746B6593F3E624866AF23F54AE12812E8BCED6898A0B66CAF6083506220E640D0D75CE9B3479048F32AD900097D4BD07329000D5CF19357E524DD9F9AAF461A83E909F4415A0074CE61C8769F1F57CF5ED10E5AF2E95BFAE701A3CB420CE09CC086F18BFACA6CE75741FD70E621C467515FED5279CA12DCAD0FB240BEED12623C51B9CA641F4B05CFC8EC203A9F2617787B7D7D1D743B63F6464C8787717329E1EB99B99AEFFF39580F3F9D77DFE2B7531048266903F54F535FAF51084DB06EF8F9267A6142072FFB5EAE1B47C2EB3FC01B587E706D297E2B95808A08A7C8DDBDD2DDEED43022CFD1AADD10FDC053722D59FF003DA3C93EF3F82E2D5341510F344B0643FBF0AD04382766905A36D4F7E121EDEEE9EFEFAFFC764161C307B0100 , N'6.1.3-40302')

GO

SET IDENTITY_INSERT [LookUp].[InvoiceStatus] ON
INSERT INTO [LookUp].[InvoiceStatus] (Id, Name, DisplayOrder, Deleted) VALUES (1, 'Sold', 1, 0);
INSERT INTO [LookUp].[InvoiceStatus] (Id, Name, DisplayOrder, Deleted) VALUES (2, 'Cancelled', 1, 0);
SET IDENTITY_INSERT [LookUp].[InvoiceStatus] OFF

GO

DECLARE @Cursor as CURSOR;
SET @Cursor = CURSOR FOR (SELECT Id, CustomerPhone, OperatorId, DeliveryStaffId, StatusId, TotalPrice, CompletionDate, CreatedById, CreatedDate from [Call])
OPEN @Cursor

DECLARE @Id as INT;
DECLARE @CustomerPhone as nvarchar(MAX);
DECLARE @OperatorId as INT;
DECLARE @DeliveryStaffId as INT;
DECLARE @StatusId as INT;
DECLARE @TotalPrice as DECIMAL;
DECLARE @CompletionDate as DATETIME;
DECLARE @CreatedById as INT;
DECLARE @CreatedDate as DATETIME;

DECLARE @InvoiceId as INT;

WHILE(1=1)
BEGIN
	FETCH NEXT FROM @Cursor 
	INTO @Id, @CustomerPhone, @OperatorId, @DeliveryStaffId, @StatusId, @TotalPrice, @CompletionDate, @CreatedById, @CreatedDate;

	IF (@@FETCH_STATUS <> 0) BEGIN BREAK END

	IF (@StatusId = 1 OR @StatusId = 3)
	BEGIN
		IF (@StatusId = 3)
		BEGIN
			SET @StatusId = 2;
			SET @CompletionDate = @CreatedDate;
		END

		INSERT INTO [Invoice]
		(CustomerPhone, OperatorId, DeliveryStaffId, StatusId, TotalPrice, CreatedById, CreatedDate, Deleted) 
		VALUES
		(@CustomerPhone, @OperatorId, @DeliveryStaffId, @StatusId, @TotalPrice, @CreatedById, @CompletionDate, 0)

		SET @InvoiceId = SCOPE_IDENTITY();

		INSERT INTO [InvoiceCommodity] (InvoiceId, CommodityId, Quantity, CreatedById, CreatedDate, Deleted)
		SELECT @InvoiceId, CommodityId, Quantity, CreatedById, CreatedDate, 0 FROM [CallCommodity]
		WHERE CallId = @Id
	END
END

CLOSE @Cursor
DEALLOCATE @Cursor
GO

UPDATE [Call] SET StatusId = 1
GO

DELETE FROM LookUp.CallStatus WHERE Id = 3
GO

UPDATE LookUp.CallStatus SET Name = 'Sent to Call Center' where Id = 1
GO